# Dunlin Classifier
## About the Project

 This program focuses on automating the annotation process for studying the natural behavior of dunlins
 (Calidris alpina) in the Dutch Wadden Sea mudflats.

The Dunlin classifier was developed as part of an internship at the Royal Netherlands Institute for Sea research (NIOZ).

The Dunlin Classifier is currently unfinished and still a work in progress. 


### Prerequisites

If you already have Anaconda or Miniconda installed you skip installing Miniconda.
Please make sure to update to at least conda 4.12.0

```bash
conda update -n base conda
```
If you already have mamba you don't need to install anaconda or miniconda. To install the Dunlin classifier
environment open mamba and replace `conda` with `mamba` when installing the Dunlin classifier environment.

## Simple step-by-step installation ###

### Install Miniconda 

Anaconda is a Python environment manager that makes it easy to install necessary dependencies without
affecting other Python software on your computer.

Miniconda is a lightweight version of Anaconda. To install it:

Go to: https://docs.conda.io/en/latest/miniconda.html#latest-miniconda-installer-links

Download the latest version for your OS.

Follow the installer instructions.
### Install the libmamba solver

LibMamba is a library for faster dependency resolution in Anaconda. 

Open Anaconda.

For Windows, you can open "Anaconda Powershell Prompt" from the start menu



Install the libmamba solver
```bash
conda install -n base conda-libmamba-solver
```

set libmamba as the solver

```bash
conda config --set solver libmamba
```

### install Dunlin Classifier

Clone this repository

```bash 
git clone https://github.com/aavanderleij/Dunlin_classifier.git
```

Go into the Dunlin_classifier directory

```bash
cd Dunlin_classifier
```

make a new conda environment using the requirements.txt:

```bash
conda env create --name dunlin_classifier --file environment.yml
```


## Usage

Open Anaconda and activate the dunlin_classifier environment.

```bash
conda activate dunlin_classifier
```

to run the Dunlin classifier in the "anaconda powershell prompt" go into the Dunlin_classifier directory and run the
flowing command:

```bash
python .\dunlin_classifier.py "c:\path\to\your\video_dir\location"
```

Default output location can be found in the video directory in the folder named "output"

The output folder contains multiple folders and a file called "output.csv". The CSV file contains the timeseries
generated by the Dunlin Classifier.

The rest of the output file are saved for testing.

The rescaled folder contains the videos used as input scaled to 1080p.  
sleap_csv contains the pixel coordinates of the dunlin found in the videos. (based on the 1080p resolution)  
sleap_predictions contains .slp files that can be loaded in to SLEAP.  
cropped_frame contains images of dunlin that have been isolated from the video and are used for classification.

### more options

direct output to different directory

```bash
python .\dunlin_classifier.py "c:\path\to\your\video_dir\location" -o "c:\path\to\output"
```

Classify every frame in video:

```bash
python .\dunlin_classifier.py "c:\path\to\your\video_dir\location" -f 1
```


## References ##

### NIOZ

The contributions of Evy Gobbens, Janna van Burik and Allert Bijleveld are gratefully acknowledged for providing
 data and insights that contributed to the development and training of the models in this project.

### SLEAP 

SLEAP is an open source deep-learning based framework for multi-animal pose tracking (Pereira et al., Nature Methods,
2022). It can be used to track any type or number of animals and includes an advanced labeling/training GUI for active
learning and proofreading. SLEAP was one of the main libraries used in this project.

T.D. Pereira, N. Tabris, A. Matsliah, D. M. Turner, J. Li, S. Ravindranath, E. S. Papadoyannis, E. Normand,
D. S. Deutsch, Z. Y. Wang, G. C. McKenzie-Smith, C. C. Mitelut, M. D. Castro, J. Dâ€™Uva, M. Kislin, D. H. Sanes,
S. D. Kocher, S. S-H, A. L. Falkner, J. W. Shaevitz, and M. Murthy. Sleap: A deep learning system for multi-animal pose
tracking. Nature Methods, 19(4), 2022


